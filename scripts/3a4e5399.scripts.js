"use strict";angular.module("tamadroidApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("tamadroidApp").controller("MainCtrl",["$scope","$interval","appMarket","$modal","alert","gameSpeed","firmwareDb",function(a,b,c,d,e,f,g){function h(a){var b=k.level*Math.random()/2;a.moodPoints=Math.max(0,a.moodPoints-b)}function i(){j&&b.cancel(j),j=b(function(){c.updateMarket(),n(),h(k),k.mood=k.moodPoints;for(var a=0;a<k.installedApps.length;a++){var d=k.installedApps[a];h(d),k.mood+=d.moodPoints}k.mood=Math.max(0,k.mood),(k.battery<=0||k.mood<=0)&&(k.battery<=0&&e("Your robot has died without energy((","error"),k.mood<=0&&e("Your robot has bored to death((","error"),b.cancel(j))},a.speed.interval*a.speed.acceleration)}a.speed=f;var j;a.$watch("speed",i,!0),a.openInstallModal=function(){c.updateMarket(),d.open({templateUrl:"views/install.html",scope:a})},a.recharge=function(){k.battery>=k.batteryMax||(k.battery=Math.min(k.battery+k.batteryMax/10,k.batteryMax),a.addXP())},a.install=function(b){if(b=angular.copy(b),b.size||(b.size=10),b.moodPoints||(b.moodPoints=10),b.size+k.memory>100)return e("Not enough memory","error"),void 0;b.installed=new Date;for(var c=0;c<k.installedApps.length;c++){var d=k.installedApps[c];if(d.name===b.name){if(d.ver===b.ver)return;k.installedApps.splice(c,1);break}}k.installedApps.push(b),a.addXP(),e(b.name+" v. "+b.ver+" has been installed")},a.uninstall=function(a){for(var b=0;b<k.installedApps.length;b++){var c=k.installedApps[b];if(c.name===a.name){k.installedApps.splice(b,1);break}}},a.$watch("robot.installedApps",function(){k.memory=k.systemMemory;for(var b=0;b<k.installedApps.length;b++)k.memory+=k.installedApps[b].size;k.memory>100&&(k.memory=100),a.eyeSize=8,k.memory>50&&(a.eyeSize=Math.round(a.eyeSize*(1+(k.memory-50)/100)))},!0);var k=a.robot={name:"Tamadroid",battery:700,batteryMax:700,memory:0,systemMemory:20,mood:100,moodPoints:100,installedApps:[],level:1,xp:0},l={},m=chroma.scale(["gray","#a4c639"]).mode("lab").domain([0,100]);a.getColorByBattery=function(){var a=Math.floor(k.battery);return l[a]||(l[a]=m(k.battery).hex()),l[a]},a.appMarket=c,a.addXP=function(){var b=k.xp,c=b+10;k.xp=c,Math.floor(c/100)>Math.floor(b/100)&&(k.level++,e("<strong>Congratulations!</strong> <br>You've got OS update to <strong>"+a.getFirmwareVersion()+"</strong>!"))};var n=function(){for(var a=5,b=k.installedApps,c=0;c<b.length;c++){var d=b[c];a+=d.batteryUsage||1}k.battery=Math.max(0,k.battery-a)};a.getBatteryLevel=function(){return Math.round(100*(a.robot.battery/a.robot.batteryMax))},a.getFirmwareVersion=function(){return g[k.level-1].name}}]),angular.module("tamadroidApp").factory("appMarket",["appDb","filterFilter","gameSpeed",function(a,b,c){function d(a,b){return Math.floor(Math.random()*(b-a+1))+a}function e(a){var b=d(0,a.length-1);return a.splice(b,1)[0]}function f(){a.length||a.restore();for(var c=e(a),d=j.concat(k);b(d,{name:c.name},!0).length;)c.name=i(c.name);c.ver||(c.ver=1),j.push(c)}function g(){if(j.length){var a=e(j);k.push(a)}}function h(){if(j.length){var a=d(0,j.length-1),b=j[a];b.ver=(b.ver||1)+1}}function i(a){return a+" "+m[d(0,m.length-1)]}var j=[{name:"FooApp",ver:1,author:"Acme Corp."},{name:"BarApp",ver:2,size:80},{name:"Ingress",ver:10,author:"Niantic",batteryUsage:20},{name:"Skype",ver:4,author:"Skype",batteryUsage:30}],k=[],l=new Date,m=["Plus","2014","Extra","Premium","Special Edition"];return{getAvailableApps:function(){return j.concat(k)},updateMarket:function(){var a=Math.floor((new Date-l)/(5*c.interval*c.acceleration));if(!(0>=a)){l=new Date;for(var b=0;a>b;b++){var d=Math.random();.2>d?f():d>.9?g():h()}}}}}]),angular.module("tamadroidApp").factory("appDb",function(){var a=[{name:"Google Play services",author:"Google"},{name:"Maps",author:"Google"},{name:"Gmail",author:"Google"},{name:"YouTube",author:"Google"},{name:"Facebook",author:"Facebook"},{name:"Angry Birds",author:"Rovio Mobile Ltd."},{name:"Skype",author:"Skype",batteryUsage:30},{name:"Twitter",author:"Twitter"},{name:"Adobe Reader",author:"Adobe Systems"},{name:"Google+",author:"Google"},{name:"Instagram",author:"Instagram"},{name:"Google Play Music",author:"Google"},{name:"Dropbox",author:"Dropbox, Inc."},{name:"Hangouts",author:"Google"},{name:"Foursquare",author:""},{name:"Ingress",author:"Niantic",batteryUsage:20},{name:"Fruit Ninja Free",author:"Halfbrick Studios"},{name:"Google Play Books",author:"Google"},{name:"Voice Search",author:"Google"},{name:"Chrome Browser - Google",author:"Google"},{name:"Google Translate",author:"Google"}],b=angular.copy(a);return a.restore=function(){a.length=0,a.push.apply(a,b)},a}),angular.module("tamadroidApp").factory("firmwareDb",function(){return[{name:"Android 1.0"},{name:"Android 1.1"},{name:"Android 1.5 Cupcake"},{name:"Android 1.6 Donut"},{name:"Android 2.0 Eclair"},{name:"Android 2.0.1 Eclair"},{name:"Android 2.1 Eclair"},{name:"Android 2.2 Froyo"},{name:"Android 2.2.1 Froyo"},{name:"Android 2.2.2 Froyo"},{name:"Android 2.2.3 Froyo"},{name:"Android 2.3 Gingerbread"},{name:"Android 2.3.1 Gingerbread"},{name:"Android 2.3.2 Gingerbread"},{name:"Android 2.3.3 Gingerbread"},{name:"Android 2.3.4 Gingerbread"},{name:"Android 2.3.5 Gingerbread"},{name:"Android 2.3.6 Gingerbread"},{name:"Android 3.0 Honeycomb"},{name:"Android 3.1 Honeycomb"},{name:"Android 3.2 Honeycomb"},{name:"Android 4.0 Ice Cream Sandwich"},{name:"Android 4.0.1 Ice Cream Sandwich"},{name:"Android 4.0.2 Ice Cream Sandwich"},{name:"Android 4.0.3 Ice Cream Sandwich"},{name:"Android 4.0.4 Ice Cream Sandwich"},{name:"Android 4.1 Jelly Bean"},{name:"Android 4.2 Jelly Bean"},{name:"Android 4.3 Jelly Bean"},{name:"Android 4.4 KitKat"}]}),angular.module("tamadroidApp").factory("alert",["$rootScope","$timeout",function(a,b){return a.alerts=[],a.closeAlert=function(b){for(var c=0;c<a.alerts.length;c++)if(a.alerts[c]===b){a.alerts.splice(c,1);break}},function(c,d,e){var f={msg:c,type:d||"success"};a.alerts.push(f),b(function(){a.closeAlert(f)},e||3e4)}}]),angular.module("tamadroidApp").factory("gameSpeed",function(){return{interval:1e3,acceleration:1}});