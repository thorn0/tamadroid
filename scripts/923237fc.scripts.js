"use strict";angular.module("tamadroidApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("tamadroidApp").controller("MainCtrl",["$scope","$interval","appMarket","$modal","alert","gameSpeed",function(a,b,c,d,e,f){function g(a){a.moodPoints=Math.max(0,a.moodPoints-j.level*Math.random()/2)}function h(){i&&b.cancel(i),i=b(function(){c.updateMarket(),j.battery=Math.max(0,j.battery-1),g(j),j.mood=j.moodPoints;for(var a=0;a<j.installedApps.length;a++){var b=j.installedApps[a];g(b),j.mood+=b.moodPoints}j.mood=Math.max(0,j.mood)},a.speed.interval*a.speed.acceleration)}a.speed=f;var i;a.$watch("speed",h,!0),a.openInstallModal=function(){c.updateMarket(),d.open({templateUrl:"views/install.html",scope:a})},a.recharge=function(){j.battery>=100||(j.battery=Math.min(j.battery+10,100),a.addXP())},a.install=function(b){if(b=angular.copy(b),b.size||(b.size=10),b.moodPoints||(b.moodPoints=10),b.size+j.memory>100)return e("Not enough memory","error"),void 0;b.installed=new Date;for(var c=0;c<j.installedApps.length;c++){var d=j.installedApps[c];if(d.name===b.name){if(d.ver===b.ver)return;j.installedApps.splice(c,1);break}}j.installedApps.push(b),a.addXP(),e(b.name+" v. "+b.ver+" has been installed")},a.uninstall=function(a){for(var b=0;b<j.installedApps.length;b++){var c=j.installedApps[b];if(c.name===a.name){j.installedApps.splice(b,1);break}}},a.$watch("robot.installedApps",function(){j.memory=j.systemMemory;for(var b=0;b<j.installedApps.length;b++)j.memory+=j.installedApps[b].size;j.memory>100&&(j.memory=100),a.eyeSize=8,j.memory>50&&(a.eyeSize=Math.round(a.eyeSize*(1+(j.memory-50)/100)))},!0);var j=a.robot={name:"Tamadroid",battery:100,memory:0,systemMemory:20,mood:100,moodPoints:100,installedApps:[],level:1,xp:0},k={},l=chroma.scale(["gray","#a4c639"]).mode("lab").domain([0,100]);a.getColorByBattery=function(){var a=Math.floor(j.battery);return k[a]||(k[a]=l(j.battery).hex()),k[a]},a.appMarket=c,a.addXP=function(){var a=j.xp,b=a+10;j.xp=b,Math.floor(b/100)>Math.floor(a/100)&&(j.level++,e("<strong>Congratulations!</strong> You've got level up!<br>Your new level is "+j.level))}}]),angular.module("tamadroidApp").factory("appMarket",["appDb","filterFilter","gameSpeed",function(a,b,c){function d(a,b){return Math.floor(Math.random()*(b-a+1))+a}function e(a){var b=d(0,a.length-1);return a.splice(b,1)[0]}function f(){a.length||a.restore();for(var c=e(a),d=j.concat(k);b(d,{name:c.name},!0).length;)c.name=i(c.name);c.ver||(c.ver=1),j.push(c)}function g(){if(j.length){var a=e(j);k.push(a)}}function h(){if(j.length){var a=d(0,j.length-1),b=j[a];b.ver=(b.ver||1)+1}}function i(a){return a+" "+m[d(0,m.length-1)]}var j=[{name:"FooApp",ver:1,author:"Acme Corp."},{name:"BarApp",ver:2,size:80},{name:"Ingress",ver:10,author:"Niantic",batteryFactor:2}],k=[],l=new Date,m=["Plus","2014","Extra","Premium","Special Edition"];return{getAvailableApps:function(){return j.concat(k)},updateMarket:function(){var a=Math.floor((new Date-l)/(5*c.interval*c.acceleration));if(!(0>=a)){l=new Date;for(var b=0;a>b;b++){var d=Math.random();.2>d?f():d>.9?g():h()}}}}}]),angular.module("tamadroidApp").factory("appDb",function(){var a=[{name:"Google Play services",author:"Google"},{name:"Maps",author:"Google"},{name:"Gmail",author:"Google"},{name:"YouTube",author:"Google"},{name:"Facebook",author:"Facebook"},{name:"Angry Birds",author:"Rovio Mobile Ltd."},{name:"Skype",author:"Skype"},{name:"Twitter",author:"Twitter"},{name:"Adobe Reader",author:"Adobe Systems"},{name:"Google+",author:"Google"},{name:"Instagram",author:"Instagram"},{name:"Google Play Music",author:"Google"},{name:"Dropbox",author:"Dropbox, Inc."},{name:"Hangouts",author:"Google"},{name:"Foursquare",author:""},{name:"Ingress",author:"Niantic"},{name:"Fruit Ninja Free",author:"Halfbrick Studios"},{name:"Google Play Books",author:"Google"},{name:"Voice Search",author:"Google"},{name:"Chrome Browser - Google",author:"Google"},{name:"Google Translate",author:"Google"}],b=angular.copy(a);return a.restore=function(){a.length=0,a.push.apply(a,b)},a}),angular.module("tamadroidApp").factory("alert",["$rootScope","$timeout",function(a,b){return a.alerts=[],a.closeAlert=function(b){for(var c=0;c<a.alerts.length;c++)if(a.alerts[c]===b){a.alerts.splice(c,1);break}},function(c,d,e){var f={msg:c,type:d||"success"};a.alerts.push(f),b(function(){a.closeAlert(f)},e||3e4)}}]),angular.module("tamadroidApp").factory("gameSpeed",function(){return{interval:2e3,acceleration:1}});